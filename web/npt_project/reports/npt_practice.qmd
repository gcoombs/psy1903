---
title: "NPT Group Level"
author: "Garth Coombs"
format: html
execute:
  echo: true
  warning: true
  message: false
---

#### Load and Inspect Group Level Data Data
```{r}
# Load here::here robustly
if (!require(here)) install.packages("here")
library(here)

# Load the study-level dataset built in our previous workflow
study_level <- read.csv(here("data/cleaned/study_level.csv"))

# Quick inspection
head(study_level)
str(study_level)
summary(study_level)
names(study_level)
```

```{r}
## Replace Column Names
names(study_level) <- c("subject_id", "tef10_score", "practice_mean_rt", "practice_acc", "magnitude_mean_rt", "magnitude_acc", "parity_mean_rt", "parity_acc", "practice_sd_rt", "magnitude_sd_rt", "parity_sd_rt")
write.csv(study_level, here::here("data/cleaned/study_level.csv"), row.names = FALSE)
names(study_level)
```

#### Calculate Difference Scores
```{r}
# A) Reaction time difference (complete this line together)
# hint: subtract magnitude mean RT from parity mean RT
study_level$rt_diff <- study_level$parity_mean_rt - study_level$magnitude_mean_rt

# B) Accuracy difference (complete together)
study_level$acc_diff <- study_level$parity_acc - study_level$magnitude_acc

# C) Overall averages across conditions
study_level$mean_rt_overall  <- rowMeans(
  study_level[, c("magnitude_mean_rt", "parity_mean_rt")],
  na.rm = TRUE
)
study_level$mean_acc_overall <- rowMeans(
  study_level[, c("magnitude_acc", "parity_acc")],
  na.rm = TRUE
)

# Peek at the new columns
head(study_level[, c("subject_id", "rt_diff", "acc_diff",
                     "mean_rt_overall", "mean_acc_overall")])
```

#### Summarize Across Participants
```{r}
# Class-level means
colMeans(study_level[, c("magnitude_mean_rt",
                         "parity_mean_rt",
                         "rt_diff")],
         na.rm = TRUE)

# Class-level variability (standard deviations)
sapply(study_level[, c("magnitude_mean_rt",
                       "parity_mean_rt",
                       "rt_diff")],
       sd, na.rm = TRUE)
```

Parity mean RT is `r round(mean(study_level$parity_mean_rt, na.rm = TRUE), 2)` ms, plus or minus `r round(sd(study_level$parity_mean_rt, na.rm = TRUE), 2)` ms.

#### Grouping using aggregate
```{r}
# Create a focus grouping variable from tef10_score
focus_cut <- mean(study_level$tef10_score, na.rm = TRUE)
study_level$focus_group <- ifelse(study_level$tef10_score >= focus_cut,
                                  "High Focus", "Low Focus")

# Check group counts
table(study_level$focus_group)

# Aggregate reaction times and differences by focus group
rt_by_focus <- aggregate(
  study_level[, c("magnitude_mean_rt",
                  "parity_mean_rt",
                  "rt_diff")],
  by = list(Focus = study_level$focus_group),
  FUN = mean
)
rt_by_focus

# Aggregate accuracies and differences by focus group
acc_by_focus <- aggregate(
  study_level[, c("magnitude_acc",
                  "parity_acc",
                  "acc_diff")],
  by = list(Focus = study_level$focus_group),
  FUN = mean
)
acc_by_focus

str(study_level)
study_level$focus_group <- as.factor(study_level$focus_group)
str(study_level$focus_group)

```

For High Focus participants, parity mean RT is approximately `r {
hf <- subset(study_level, focus_group == "High Focus");
round(mean(hf$parity_mean_rt, na.rm = TRUE), 2) }` ms, plus or minus `r {
hf <- subset(study_level, focus_group == "High Focus");
round(sd(hf$parity_mean_rt, na.rm = TRUE), 2) }` ms.
For Low Focus participants, parity mean RT is approximately `r {
lf <- subset(study_level, focus_group == "Low Focus");
round(mean(lf$parity_mean_rt, na.rm = TRUE), 2) }` ms, plus or minus `r {
lf <- subset(study_level, focus_group == "Low Focus");
round(sd(lf$parity_mean_rt, na.rm = TRUE), 2) }` ms.
This is a mean difference of `r round(
  mean(study_level$parity_mean_rt[study_level$focus_group == "High Focus"], na.rm = TRUE) -
  mean(study_level$parity_mean_rt[study_level$focus_group == "Low Focus"], na.rm = TRUE),
  2
)` ms.

For High Focus participants, magnitude mean RT is approximately `r {
hf <- subset(study_level, focus_group == "High Focus");
round(mean(hf$magnitude_mean_rt, na.rm = TRUE), 2) }` ms, plus or minus `r {
hf <- subset(study_level, focus_group == "High Focus");
round(sd(hf$magnitude_mean_rt, na.rm = TRUE), 2) }` ms.
For Low Focus participants, magnitude mean RT is approximately `r {
lf <- subset(study_level, focus_group == "Low Focus");
round(mean(lf$magnitude_mean_rt, na.rm = TRUE), 2) }` ms, plus or minus `r {
lf <- subset(study_level, focus_group == "Low Focus");
round(sd(lf$magnitude_mean_rt, na.rm = TRUE), 2) }` ms.
This is a mean difference of `r round(
  mean(study_level$magnitude_mean_rt[study_level$focus_group == "High Focus"], na.rm = TRUE) -
  mean(study_level$magnitude_mean_rt[study_level$focus_group == "Low Focus"], na.rm = TRUE),
  2
)` ms.

#### Exploring and Interpreting
```{r}
# Summaries for key variables
summary(study_level[, c("magnitude_mean_rt",
                        "parity_mean_rt",
                        "rt_diff",
                        "magnitude_acc",
                        "parity_acc",
                        "acc_diff")])

# Optional exploration: association between overall RT and overall accuracy
cor(study_level$mean_rt_overall, study_level$mean_acc_overall, use = "complete.obs")
```

The correlation between overall reaction time and overall accuracy is `r round(cor(study_level$mean_rt_overall, study_level$mean_acc_overall, use = "complete.obs"), 2)`.


